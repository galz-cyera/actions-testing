"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.irrerateDependencies = void 0;
const run_topologically_1 = require("@lerna/run-topologically");
const package_1 = require("./package");
async function irrerateDependencies(lernaPackages, packageGraph, concurrency, rejectCycles, defaultDockerFile) {
    const packages = [];
    await (0, run_topologically_1.runTopologically)(lernaPackages, async (lernaPackage) => {
        const packageGraphNode = packageGraph.get(lernaPackage.name);
        if (!packageGraphNode) {
            throw new Error(`Package ${lernaPackage.name} missing in packageGraph`);
        }
        const pkg = new package_1.Package(lernaPackage.name, lernaPackage, packageGraphNode);
        await pkg.loadDockerfile(defaultDockerFile);
        packages.push(pkg);
    }, {
        concurrency: concurrency,
        rejectCycles: rejectCycles,
    });
    return packages;
}
exports.irrerateDependencies = irrerateDependencies;
//# sourceMappingURL=itterate-dependencies.js.map